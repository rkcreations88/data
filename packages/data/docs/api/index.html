<!DOCTYPE html><html class="default" lang="en" data-base="./"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@adobe/data - v0.9.16</title><meta name="description" content="Documentation for @adobe/data"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><script async src="assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="index.html" class="title">@adobe/data - v0.9.16</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h1>@adobe/data - v0.9.16</h1></div><div class="tsd-panel tsd-typography"><h1 id="adobedata" class="tsd-anchor-link">@adobe/data<a href="#adobedata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p>Adobe Data Oriented Programming Library</p>
<h2 id="documentation" class="tsd-anchor-link">Documentation<a href="#documentation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://git.corp.adobe.com/pages/neuralfiltersplatform/firefly-data/docs/api/">Main Page</a></p>
<p><a href="https://git.corp.adobe.com/pages/neuralfiltersplatform/firefly-data/docs/perftest.html">ECS Performance Test</a></p>
<h2 id="breaking-api-changes" class="tsd-anchor-link">Breaking API Changes<a href="#breaking-api-changes" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Until we reach 1.0.0, minor version changes may be API breaking.</p>
<h2 id="data-oriented-programming" class="tsd-anchor-link">Data Oriented Programming<a href="#data-oriented-programming" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This library is built using a data oriented and functional programming paradigm.
We prefer composition over inheritance, avoid classes when possible and emphasize separation of concerns.</p>
<h2 id="data" class="tsd-anchor-link">Data<a href="#data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This library uses data oriented design paradigm and prefers pure functional interfaces whenever practical.</p>
<p>For our purposes, <code>Data</code> is immutable <code>JSON</code> (de)serializable objects and primitives.</p>
<h3 id="why-immutable-data" class="tsd-anchor-link">Why immutable Data?<a href="#why-immutable-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>We prefer Data because it is easy to:</p>
<ul>
<li>serialize</li>
<li>deserialize</li>
<li>inspect</li>
<li>compare</li>
<li>hash</li>
<li>validate</li>
</ul>
<p>We prefer immutable Data because it is easy to:</p>
<ul>
<li>reason about</li>
<li>avoid side effects</li>
<li>avoid defensive copying</li>
<li>use for pure function arguments and return values</li>
<li>use with concurrency</li>
<li>memoize results
<ul>
<li>use as cache key (stringified)</li>
<li>use as cache value</li>
</ul>
</li>
</ul>
<h3 id="what-is-data-oriented-design" class="tsd-anchor-link">What is Data Oriented Design?<a href="#what-is-data-oriented-design" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sanders Mertens covers this thoroughly in his ECS FAQ:</p>
<p><a href="https://github.com/SanderMertens/ecs-faq?tab=readme-ov-file#what-is-data-oriented-design">https://github.com/SanderMertens/ecs-faq?tab=readme-ov-file#what-is-data-oriented-design</a></p>
<h3 id="data-schemas" class="tsd-anchor-link">Data Schemas<a href="#data-schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When runtime type information is required we use <code>JSON Schema</code>. In order to avoid redundancy, we can use <code>FromSchema</code> to derive a typescript type at compile time.</p>
<p>Example:</p>
<pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">Float32Schema</span><span class="hl-1"> = { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-1">, </span><span class="hl-3">precision:</span><span class="hl-1"> </span><span class="hl-5">1</span><span class="hl-1"> } </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-7">const</span><span class="hl-1"> </span><span class="hl-6">satisfies</span><span class="hl-1"> </span><span class="hl-7">Schema</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">Float32</span><span class="hl-1"> = </span><span class="hl-3">FromSchema</span><span class="hl-1">&lt;</span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-3">Float32Schema</span><span class="hl-1">&gt;; </span><span class="hl-8">// number</span>
</code><button type="button">Copy</button></pre>

<p>It is important that we use <code>as const</code> for the schema definition. Without that, the typeof Float32Schema would be <code>{ type: string, precision: number }</code> instead of <code>{ type: &quot;number&quot;, precision: 1 }</code> and we would not be able to derive a correct type using <code>FromSchema</code>.</p>
<h3 id="normalized-data" class="tsd-anchor-link">Normalized Data<a href="#normalized-data" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Data is considered &quot;Normalized&quot; when all object keys contained anywhere within it are lexigraphically sorted. We include a <code>normalize</code> function which performs this conversion. This is particularly useful when you want to use data as a cache key.</p>
<pre><code class="typescript"><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">notNormalized</span><span class="hl-1"> = { </span><span class="hl-3">b:</span><span class="hl-1"> </span><span class="hl-5">2</span><span class="hl-1">, </span><span class="hl-3">a:</span><span class="hl-1"> </span><span class="hl-5">1</span><span class="hl-1"> };</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">normalized</span><span class="hl-1"> = </span><span class="hl-9">normalize</span><span class="hl-1">(</span><span class="hl-3">notNormalized</span><span class="hl-1">); </span><span class="hl-8">// { a: 1, b: 2 }</span>
</code><button type="button">Copy</button></pre>

<h2 id="observables" class="tsd-anchor-link">Observables<a href="#observables" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>An <code>Observable&lt;T&gt;</code> is a subscription function that you can pass a callback function to. Your callback function can accept a single argument of type <code>T</code>. The subscription function returns a dispose function that accepts no parameters and can be called at any point in the future to cancel your subscription.</p>
<p>Your callback function <em>may</em> be called back synchronously (before the initial call returns) zero or one times and asynchronously later any number of times.</p>
<p>For more information see the <a href="media/observe.html">Observable API documentation</a></p>
<h3 id="observable-types" class="tsd-anchor-link">Observable Types<a href="#observable-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-8">/**</span><br/><span class="hl-8"> * Called to add a new observer to an Observable.</span><br/><span class="hl-8"> * Returns an Unobserve function that can be called to stop observing the Observable.</span><br/><span class="hl-8"> */</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-7">Observable</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt; = (</span><span class="hl-3">observer</span><span class="hl-1">: </span><span class="hl-7">Callback</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Unobserve</span><span class="hl-1">;</span><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * Callback function called zero or more times with a sequence of values.</span><br/><span class="hl-8"> * *may* be called back synchronously, immediately when selector function is called.</span><br/><span class="hl-8"> * *may* also be called back asynchronously later any number of times.</span><br/><span class="hl-8"> * *may* be called multiple sequential times with the same value.</span><br/><span class="hl-8"> */</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-7">Callback</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt; = (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-7">T</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">;</span><br/><span class="hl-8">/**</span><br/><span class="hl-8"> * Function called to stop observing an Observable.</span><br/><span class="hl-8"> */</span><br/><span class="hl-6">export</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> </span><span class="hl-7">Unobserve</span><span class="hl-1"> = () </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-7">void</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<p>An Observable can be thought of sort of like a Promise but with a few important differences.</p>
<ul>
<li>A Promise only yields a single value, an Observable yields a sequence of values.</li>
<li>A Promise can reject with an error, an Observable can not. (It could yield type <code>MyResult | MyError</code> though.)</li>
<li>A Promise can only resolve asynchronously, an Observable <em>may</em> yield an initial result synchronously.
<ul>
<li>An Observable is allowed to call the Callback callback function immediately upon observation if it has a value.</li>
</ul>
</li>
<li>A Promise begins executing immediately, an Observable may lazily wait for a first observer before taking any action.</li>
<li>An Observable can be unobserved.</li>
</ul>
<h3 id="observable-creation" class="tsd-anchor-link">Observable Creation<a href="#observable-creation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This simple definition of an Observable makes it very easy to create them from various sources.</p>
<ul>
<li><code>fromConstant&lt;T&gt;(value: T) =&gt; Observable&lt;T&gt;</code></li>
<li><code>fromPromise&lt;T&gt;(promise: Promise&lt;T&gt;): Observable&lt;T&gt;</code></li>
<li><code>fromPromiseWithError&lt;T, E extends Error&gt;(promise: Promise&lt;T&gt;): Observable&lt;T | E&gt;</code></li>
<li><code>fromObservableProperties</code> converts an object with named Observable values into a single Observable of an object with corresponding types.</li>
</ul>
<p>For instance:</p>
<pre><code class="typescript"><span class="hl-9">fromObservables</span><span class="hl-1">({ </span><span class="hl-3">a:</span><span class="hl-1"> </span><span class="hl-9">fromConstant</span><span class="hl-1">(</span><span class="hl-5">1</span><span class="hl-1">), </span><span class="hl-3">b:</span><span class="hl-1"> </span><span class="hl-9">fromConstant</span><span class="hl-1">(</span><span class="hl-4">&quot;s&quot;</span><span class="hl-1">)})</span><br/><span class="hl-8">// yields type Observable&lt;{ a: number, b: string }&gt;</span>
</code><button type="button">Copy</button></pre>

<p><code>fromObservableProperties</code> will only yield a result once every contained observable has provided a result. If some properties are optional then use the <code>withOptional</code> higher order function described below.</p>
<h3 id="observable-modification" class="tsd-anchor-link">Observable Modification<a href="#observable-modification" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>They are also very easy to modify in order to build higher order Observables.</p>
<p>For the purposes of discussion let us use an array to indicate the sequential values yielded by an Observable with the first element being any synchronous callback and <code>void</code> meaning no synchronous callback.</p>
<p>So our <code>fromConstant(12)</code> would yield <code>[12]</code> and <code>fromPromise(Promise.resolve(12))</code> would yield <code>[void, 12]</code></p>
<p>These examples will use the form of: Sequence Before =&gt; Higher Order Function =&gt; Sequence After.</p>
<p>withDeduplicate removes any sequentially equivalent values:</p>
<p><code>[1, 1, 2, 2, 2, 3]</code> =&gt; <code>withDeduplicate</code> =&gt; <code>[1, 2, 3]</code></p>
<p>withDefault replaces any undefined values, including initial synchronous value with a default value:</p>
<p><code>[void, 1, 2, undefined, 4]</code> =&gt; <code>withDefault(-1)</code> =&gt; <code>[-1, 1, 2, -1, 4]</code></p>
<p>withMap applies a mapping function to each value at notification time:</p>
<p><code>[void, 1, 2, 3]</code> =&gt; <code>withMap(x =&gt; x * 2)</code> =&gt; <code>[void, 2, 4, 6]</code></p>
<p>withOptional converts an <code>Observable&lt;T&gt;</code> to <code>Observable&lt;T | undefined&gt;</code> and will always respond synchronously.</p>
<p><code>[void, 1, 2, 3, 4]</code> =&gt; <code>withOptional</code> =&gt; <code>[undefined, 1, 2, 3, 4]</code></p>
<h2 id="cache" class="tsd-anchor-link">Cache<a href="#cache" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>The cache module contains functions and interfaces related to caching, hashing, memoization and storage and retrieval of <code>Blob</code>s.</p>
<p>The <code>memoize</code> function and <code>BlobStore</code> are the most important public interfaces in the cache submodule. They are described below. See the API reference for hashing and other lower level functions.</p>
<p>The <code>memoize</code> function can be used to cache expensive, deterministic, asynchronous functions that take data arguments and return data results. In addition to caching the results, it also blocks multiple simultaneous calls with the same arguments and makes them wait for the first result.</p>
<h3 id="blobstore" class="tsd-anchor-link">BlobStore<a href="#blobstore" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>It is important to handle <code>Blob</code>s correctly within an application.</p>
<p>The <code>BlobStore</code> interface and corresponding <code>blobStore</code> exported instance provide a convenient way to convert <code>Blob</code>s into small JSON handles to them called <code>BlobRef</code>s. Those <code>BlobRef</code>s can later be converted back into a <code>Blob</code>.</p>
<p><code>Blob</code>s within the <code>blobStore</code> are generally persisted across sessions using the browsers buid in <code>Cache</code> storage.</p>
<p><code>BlobRef</code>s have a number of advantages over directly using blobs.
<code>BlobRef</code>s are:</p>
<ul>
<li>small json objects</li>
<li>deterministic for each <code>Blob</code> based on mime type and content.</li>
<li>suitable for persistence to locations with limited size.</li>
<li>suitable for use as a cache key</li>
<li>suitable for use as a cache value</li>
</ul>
<h2 id="schemas" class="tsd-anchor-link">Schemas<a href="#schemas" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Contains some standard data type schemas in JSON Schema format for convenience. These types are most frequently used when describing components within the Entity Component System. Knowing the precise size and signedness of primitive numeric types allows the ECS to store these values within tightly packed typed arrays internally. This makes memory usage and processing time more efficient.</p>
<h2 id="entity-component-system-ecs" class="tsd-anchor-link">Entity Component System (ECS)<a href="#entity-component-system-ecs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This ECS database is a high performance, strongly typed typescript implementation inspired by the Sanders Mertens C++ based <a href="https://www.flecs.dev/flecs/md_docs_2Docs.html">Flecs</a>.</p>
<p>This library provides two main interfaces for ECS operations: <strong>Store</strong> and <strong>Database</strong>. They share the same read API but differ significantly in their approach to writing and observability.</p>
<h3 id="store-interface" class="tsd-anchor-link">Store Interface<a href="#store-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <strong>Store</strong> is the foundational, low-level interface for direct ECS data operations.</p>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li><strong>Direct Access</strong>: Provides immediate, synchronous read/write access to entities, components, and resources</li>
<li><strong>No Transaction Control</strong>: Changes are applied directly without transaction boundaries</li>
<li><strong>No Observability</strong>: Changes are not automatically observable or trackable</li>
<li><strong>High Performance</strong>: Minimal overhead for direct operations using Structure of Arrays (SoA) with linear memory layout of numeric types for optimal cache performance</li>
<li><strong>Core ECS Operations</strong>: Includes entity creation, component updates, archetype querying, and resource management</li>
</ul>
<p><strong>Usage</strong>: Ideal for scenarios requiring fast, direct ECS manipulation where you don't need change tracking or transactional safety.</p>
<pre><code class="typescript"><span class="hl-8">// Create a store with components, resources, and archetypes</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">store</span><span class="hl-1"> = </span><span class="hl-9">createStore</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><br/><span class="hl-1">    </span><span class="hl-3">position:</span><span class="hl-1"> </span><span class="hl-3">Vec3</span><span class="hl-1">.</span><span class="hl-3">schema</span><span class="hl-1">, </span><br/><span class="hl-1">    </span><span class="hl-3">health:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-4">&quot;number&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-3">player:</span><span class="hl-1"> { </span><span class="hl-3">const:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> } </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  { </span><br/><span class="hl-1">    </span><span class="hl-3">gravity:</span><span class="hl-1"> { </span><span class="hl-3">default:</span><span class="hl-1"> </span><span class="hl-5">9.8</span><span class="hl-1"> </span><span class="hl-6">as</span><span class="hl-1"> </span><span class="hl-7">number</span><span class="hl-1"> } </span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-3">Player:</span><span class="hl-1"> [</span><span class="hl-4">&quot;position&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;health&quot;</span><span class="hl-1">, </span><span class="hl-4">&quot;player&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-3">Particle:</span><span class="hl-1"> [</span><span class="hl-4">&quot;position&quot;</span><span class="hl-1">]</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-8">// Direct operations</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">playerId</span><span class="hl-1"> = </span><span class="hl-3">store</span><span class="hl-1">.</span><span class="hl-3">archetypes</span><span class="hl-1">.</span><span class="hl-3">Player</span><span class="hl-1">.</span><span class="hl-9">insert</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-3">position:</span><span class="hl-1"> [</span><span class="hl-5">0</span><span class="hl-1">, </span><span class="hl-5">0</span><span class="hl-1">, </span><span class="hl-5">0</span><span class="hl-1">], </span><br/><span class="hl-1">  </span><span class="hl-3">health:</span><span class="hl-1"> </span><span class="hl-5">100</span><span class="hl-1">, </span><br/><span class="hl-1">  </span><span class="hl-3">player:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> </span><br/><span class="hl-1">});</span><br/><span class="hl-3">store</span><span class="hl-1">.</span><span class="hl-9">update</span><span class="hl-1">(</span><span class="hl-3">playerId</span><span class="hl-1">, { </span><span class="hl-3">position:</span><span class="hl-1"> [</span><span class="hl-5">1</span><span class="hl-1">, </span><span class="hl-5">1</span><span class="hl-1">, </span><span class="hl-5">1</span><span class="hl-1">] });</span><br/><span class="hl-3">store</span><span class="hl-1">.</span><span class="hl-3">resources</span><span class="hl-1">.</span><span class="hl-3">gravity</span><span class="hl-1"> = </span><span class="hl-5">10.0</span><span class="hl-1">;</span>
</code><button type="button">Copy</button></pre>

<h3 id="database-interface" class="tsd-anchor-link">Database Interface<a href="#database-interface" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The <strong>Database</strong> wraps a Store to provide <strong>transaction-based operations</strong> with <strong>full observability</strong>.</p>
<p><strong>Key Characteristics:</strong></p>
<ul>
<li><strong>Transaction-Based</strong>: All changes must occur within predefined atomic transactions that can be undone.</li>
<li><strong>Full Observability</strong>: Every change is observable through the <code>observe</code> API</li>
<li><strong>Predefined Operations</strong>: Uses predefined transaction functions rather than direct mutations</li>
<li><strong>Undo/Redo Support</strong>: Transactions generate undo/redo operations automatically</li>
<li><strong>Change Tracking</strong>: Tracks which entities, components, and archetypes changed</li>
<li><strong>Event Notifications</strong>: Automatically notifies observers of changes</li>
</ul>
<p><strong>Usage</strong>: Ideal for applications requiring change history, multiplayer synchronization, undo/redo functionality, or reactive UI updates.</p>
<p><strong>Important Note</strong>: Even when using a Database, transaction functions are written as direct modifications to the underlying Store interface. The Database wraps these operations to provide transactional guarantees and observability.</p>
<pre><code class="typescript"><span class="hl-8">// Create a database with predefined transactions</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">database</span><span class="hl-1"> = </span><span class="hl-9">createDatabase</span><span class="hl-1">(</span><span class="hl-3">store</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-9">createPlayer</span><span class="hl-1">(</span><span class="hl-3">t</span><span class="hl-1">, </span><span class="hl-3">args</span><span class="hl-1">: { </span><span class="hl-3">position</span><span class="hl-1">: </span><span class="hl-7">Vector3</span><span class="hl-1">, </span><span class="hl-3">health</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-8">// Transaction function receives Store interface for direct operations</span><br/><span class="hl-1">    </span><span class="hl-6">return</span><span class="hl-1"> </span><span class="hl-3">t</span><span class="hl-1">.</span><span class="hl-3">archetypes</span><span class="hl-1">.</span><span class="hl-3">Player</span><span class="hl-1">.</span><span class="hl-9">insert</span><span class="hl-1">({ </span><br/><span class="hl-1">      ...</span><span class="hl-3">args</span><span class="hl-1">, </span><br/><span class="hl-1">      </span><span class="hl-3">player:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> </span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">movePlayer</span><span class="hl-1">(</span><span class="hl-3">t</span><span class="hl-1">, </span><span class="hl-3">args</span><span class="hl-1">: { </span><span class="hl-3">entity</span><span class="hl-1">: </span><span class="hl-7">Entity</span><span class="hl-1">, </span><span class="hl-3">position</span><span class="hl-1">: </span><span class="hl-7">Vector3</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-8">// Direct Store operations within transaction context</span><br/><span class="hl-1">    </span><span class="hl-3">t</span><span class="hl-1">.</span><span class="hl-9">update</span><span class="hl-1">(</span><span class="hl-3">args</span><span class="hl-1">.</span><span class="hl-3">entity</span><span class="hl-1">, { </span><span class="hl-3">position:</span><span class="hl-1"> </span><span class="hl-3">args</span><span class="hl-1">.</span><span class="hl-3">position</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-9">setGravity</span><span class="hl-1">(</span><span class="hl-3">t</span><span class="hl-1">, </span><span class="hl-3">gravity</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-8">// Direct resource modification within transaction</span><br/><span class="hl-1">    </span><span class="hl-3">t</span><span class="hl-1">.</span><span class="hl-3">resources</span><span class="hl-1">.</span><span class="hl-3">gravity</span><span class="hl-1"> = </span><span class="hl-3">gravity</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Execute transactions (these provide observability and undo/redo)</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">playerId</span><span class="hl-1"> = </span><span class="hl-3">database</span><span class="hl-1">.</span><span class="hl-3">transactions</span><span class="hl-1">.</span><span class="hl-9">createPlayer</span><span class="hl-1">({ </span><br/><span class="hl-1">  </span><span class="hl-3">position:</span><span class="hl-1"> [</span><span class="hl-5">10</span><span class="hl-1">, </span><span class="hl-5">20</span><span class="hl-1">, </span><span class="hl-5">0</span><span class="hl-1">], </span><br/><span class="hl-1">  </span><span class="hl-3">health:</span><span class="hl-1"> </span><span class="hl-5">100</span><span class="hl-1"> </span><br/><span class="hl-1">});</span><br/><span class="hl-3">database</span><span class="hl-1">.</span><span class="hl-3">transactions</span><span class="hl-1">.</span><span class="hl-9">movePlayer</span><span class="hl-1">({ </span><span class="hl-3">entity:</span><span class="hl-1"> </span><span class="hl-3">playerId</span><span class="hl-1">, </span><span class="hl-3">position:</span><span class="hl-1"> [</span><span class="hl-5">15</span><span class="hl-1">, </span><span class="hl-5">25</span><span class="hl-1">, </span><span class="hl-5">5</span><span class="hl-1">] });</span><br/><br/><span class="hl-8">// Observe all changes</span><br/><span class="hl-3">database</span><span class="hl-1">.</span><span class="hl-3">observe</span><span class="hl-1">.</span><span class="hl-9">transactions</span><span class="hl-1">((</span><span class="hl-3">result</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Transaction applied:&#39;</span><span class="hl-1">, </span><span class="hl-3">result</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Changed entities:&#39;</span><span class="hl-1">, </span><span class="hl-3">result</span><span class="hl-1">.</span><span class="hl-3">changedEntities</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Undo operations:&#39;</span><span class="hl-1">, </span><span class="hl-3">result</span><span class="hl-1">.</span><span class="hl-3">undo</span><span class="hl-1">);</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-8">// Observe specific entities</span><br/><span class="hl-3">database</span><span class="hl-1">.</span><span class="hl-3">observe</span><span class="hl-1">.</span><span class="hl-9">entity</span><span class="hl-1">(</span><span class="hl-3">playerId</span><span class="hl-1">)((</span><span class="hl-3">entityData</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">if</span><span class="hl-1"> (</span><span class="hl-3">entityData</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">console</span><span class="hl-1">.</span><span class="hl-9">log</span><span class="hl-1">(</span><span class="hl-4">&#39;Player moved to:&#39;</span><span class="hl-1">, </span><span class="hl-3">entityData</span><span class="hl-1">.</span><span class="hl-3">position</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<h3 id="what-is-an-ecs" class="tsd-anchor-link">What is an ECS?<a href="#what-is-an-ecs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sanders Mertens also covers this thoroughly in his ECS FAQ:</p>
<p><a href="https://github.com/SanderMertens/ecs-faq?tab=readme-ov-file#what-is-ecs">https://github.com/SanderMertens/ecs-faq?tab=readme-ov-file#what-is-ecs</a></p>
<p>In addition to the Entity, Component and System definitions which are standard, we also use the term Resource. A Resource is just a value which is defined globally on the ECS itself and not attached to any specific Entity. You can think of them as a singleton Component.</p>
<h2 id="performance-test" class="tsd-anchor-link">Performance Test<a href="#performance-test" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><a href="https://git.corp.adobe.com/pages/neuralfiltersplatform/firefly-data/docs/perftest.html">Performance Test</a></p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="assets/icons.svg#icon-chevronDown"></use></svg><h3>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#adobedata"><span>@adobe/data</span></a><ul><li><a href="#documentation"><span>Documentation</span></a></li><li><a href="#breaking-api-changes"><span>Breaking <wbr/>API <wbr/>Changes</span></a></li><li><a href="#data-oriented-programming"><span>Data <wbr/>Oriented <wbr/>Programming</span></a></li><li><a href="#data"><span>Data</span></a></li><li><ul><li><a href="#why-immutable-data"><span>Why immutable <wbr/>Data?</span></a></li><li><a href="#what-is-data-oriented-design"><span>What is <wbr/>Data <wbr/>Oriented <wbr/>Design?</span></a></li><li><a href="#data-schemas"><span>Data <wbr/>Schemas</span></a></li><li><a href="#normalized-data"><span>Normalized <wbr/>Data</span></a></li></ul></li><li><a href="#observables"><span>Observables</span></a></li><li><ul><li><a href="#observable-types"><span>Observable <wbr/>Types</span></a></li><li><a href="#observable-creation"><span>Observable <wbr/>Creation</span></a></li><li><a href="#observable-modification"><span>Observable <wbr/>Modification</span></a></li></ul></li><li><a href="#cache"><span>Cache</span></a></li><li><ul><li><a href="#blobstore"><span>Blob<wbr/>Store</span></a></li></ul></li><li><a href="#schemas"><span>Schemas</span></a></li><li><a href="#entity-component-system-ecs"><span>Entity <wbr/>Component <wbr/>System (<wbr/>ECS)</span></a></li><li><ul><li><a href="#store-interface"><span>Store <wbr/>Interface</span></a></li><li><a href="#database-interface"><span>Database <wbr/>Interface</span></a></li><li><a href="#what-is-an-ecs"><span>What is an <wbr/>ECS?</span></a></li></ul></li><li><a href="#performance-test"><span>Performance <wbr/>Test</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html">@adobe/data - v0.9.16</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
